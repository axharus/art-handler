"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var ArtHandler=function(){function e(){var t=this;_classCallCheck(this,e),this.endTime=0,this.count=0,this.startTime=new Date,this.speed_breakpoint=14e3,this.speed_js_trashhole=9,this.speed_server_trashhole=3,this.handle_url="/arthandler/receive",this.path=window.location.href,this.screen=window.innerWidth+"x"+window.innerHeight,this.dom_loaded=!1,window.arthandlerurl&&(this.handle_url=window.arthandlerurl),window.addEventListener("load",function(){setTimeout(function(){t.dom_loaded=!0},1e3)}),this.time_start=0;try{this.time_start=performance.now()}catch(e){console.log("Performance does not exist")}this.xhrRunner(),this.jsRunner(),this.onLoadRunner(),this.measure_speed_server()}return _createClass(e,[{key:"error_handler",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"js",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.count>=10)return console.log("ArtHandler: error prevented because of  > 10"),400===this.count&&this.error_handler("Error amount on page bigger than 400, something wrong with browser \n",298),this.count++,!1;this.count++;var o={error:e.substring(0,1e3),path:this.path,screen:this.screen,scroll:this.dom_loaded?window.pageYOffset:0,timer:this.end(),status_code:null!=t?t:500,type:n};if(r&&(o.time=r),window.artpreventor&&window.artpreventor.includes(o.status_code))return window.artdebug&&!0===window.artdebug&&console.log("Sending prevented: ",o),!1;window.artdebug&&!0===window.artdebug&&console.log("Content before sending: ",o),window.arthandlerurl,this.ajax_get(this.handle_url,o,function(e){window.artdebug&&!0===window.artdebug&&console.log("Response: ",e)})}},{key:"measure_speed_server",value:function(){var e=window.artloadingtime,t="Speed too low Error \n";e>this.speed_server_trashhole&&(t+="SERVER Load Time: "+e+"\n",this.error_handler(t,299,"speed_server",e))}},{key:"measure_speed_js",value:function(){var e=999,t="Speed too low Error \n";try{e=((performance.now()-this.time_start)/1e3).toFixed(2)}catch(e){console.log("Performance error")}e>this.speed_js_trashhole&&(t+="JS Load Time: "+e+"\n",this.error_handler(t,299,"speed_js",e))}},{key:"jsRunner",value:function(){var e=this;window.addEventListener("error",function(t){var n=500,r="JS Error \n";t.error?(r+="Message: "+t.error.message+"\n",r+="Stacktrace: "+t.error.stack+"\n"):t.target?(r+="Error with element: "+t.target.outerHTML+"\n",n=404):r+="Some unexpect error: "+JSON.stringify(temp1)+"\n",e.error_handler(r,n)},!0)}},{key:"xhrRunner",value:function(){var e=this;this.addXMLRequestCallback(function(t){var n=t.onreadystatechange;t.onreadystatechange=function(r){if(n&&n(r),4===t.readyState&&200!==t.status){var o="XHR Error \n",a=404;0===t.status?(o+="Error status is undefined \n",o+="It can be AdBlock \n"):(o+="Status code: "+t.status+"\n",o+="Status text: "+t.statusText+"\n",o+="Response: "+t.response+"\n",a=t.status?t.status:404),e.error_handler(o,a)}}})}},{key:"onLoadRunner",value:function(){var e=this,t=!1;setTimeout(function(){t||e.measure_speed_js(),t=!0},this.speed_breakpoint),window.addEventListener("load",function(n){t||e.measure_speed_js(),t=!0})}},{key:"addXMLRequestCallback",value:function(e){var t,n;XMLHttpRequest.callbacks?XMLHttpRequest.callbacks.push(e):(XMLHttpRequest.callbacks=[e],t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){for(n=0;n<XMLHttpRequest.callbacks.length;n++)XMLHttpRequest.callbacks[n](this);t.apply(this,arguments)})}},{key:"ajax_x",value:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var e,t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(e){}return e}},{key:"ajax_send",value:function(e,t,n,r,o){void 0===o&&(o=!0);var a=this.ajax_x();a.open(n,e,o),a.onreadystatechange=function(){4===a.readyState&&t(a.responseText)},"POST"===n&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(r)}},{key:"ajax_get",value:function(e,t,n,r){var o=[];for(var a in t)o.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));this.ajax_send(e+(o.length?"?"+o.join("&"):""),n,"GET",null,r)}},{key:"end",value:function(){this.endTime=new Date;var e=this.endTime-this.startTime;return e/=1e3,Math.round(e)}}]),e}();!function(){try{window.artHandler=new ArtHandler}catch(e){console.log("Something wrong with debuger",e)}}();
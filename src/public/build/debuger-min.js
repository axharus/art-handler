"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var ArtHandler=function(){function e(){_classCallCheck(this,e),this.endTime=0,this.count=0,this.startTime=new Date,this.speed_breakpoint=14e3,this.speed_js_trashhole=9,this.speed_server_trashhole=3,this.handle_url="/arthandler/receive",window.arthandlerurl&&(this.handle_url=window.arthandlerurl),this.time_start=0;try{this.time_start=performance.now()}catch(e){console.log("Performance does not exist")}this.xhrRunner(),this.jsRunner(),this.onLoadRunner(),this.measure_speed_server()}return _createClass(e,[{key:"error_handler",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"js",n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.count>=10)return console.log("ArtHandler: error prevented because of  > 10"),400===this.count&&this.error_handler("Error amount on page bigger than 400, something wrong with browser \n",298),this.count++,!1;this.count++;var a={error:e.substring(0,1e3),path:window.location.href,screen:window.innerWidth+"x"+window.innerHeight,scroll:window.pageYOffset,timer:this.end(),status_code:null!=t?t:500,type:r};if(n&&(a.time=n),window.artpreventor&&window.artpreventor.includes(a.status_code))return window.artdebug&&!0===window.artdebug&&console.log("Sending prevented: ",a),!1;window.artdebug&&!0===window.artdebug&&console.log("Content before sending: ",a),window.arthandlerurl,this.ajax_get(this.handle_url,a,function(e){window.artdebug&&!0===window.artdebug&&console.log("Response: ",e)})}},{key:"measure_speed_server",value:function(){var e=window.artloadingtime,t="Speed too low Error \n";e>this.speed_server_trashhole&&(t+="SERVER Load Time: "+e+"\n",this.error_handler(t,299,"speed_server",e))}},{key:"measure_speed_js",value:function(){var e=999,t="Speed too low Error \n";try{e=((performance.now()-this.time_start)/1e3).toFixed(2)}catch(e){console.log("Performance error")}e>this.speed_js_trashhole&&(t+="JS Load Time: "+e+"\n",this.error_handler(t,299,"speed_js",e))}},{key:"jsRunner",value:function(){var e=this;window.addEventListener("error",function(t){var r=500,n="JS Error \n";t.error?(n+="Message: "+t.error.message+"\n",n+="Stacktrace: "+t.error.stack+"\n"):t.target?(n+="Error with element: "+t.target.outerHTML+"\n",r=404):n+="Some unexpect error: "+JSON.stringify(temp1)+"\n",e.error_handler(n,r)},!0)}},{key:"xhrRunner",value:function(){var e=this;this.addXMLRequestCallback(function(t){var r=t.onreadystatechange;t.onreadystatechange=function(n){if(r&&r(n),4===t.readyState&&200!==t.status){var a="XHR Error \n",o=404;0===t.status?(a+="Error status is undefined \n",a+="It can be AdBlock \n"):(a+="Status code: "+t.status+"\n",a+="Status text: "+t.statusText+"\n",a+="Response: "+t.response+"\n",o=t.status?t.status:404),e.error_handler(a,o)}}})}},{key:"onLoadRunner",value:function(){var e=this,t=!1;setTimeout(function(){t||e.measure_speed_js(),t=!0},this.speed_breakpoint),window.addEventListener("load",function(r){t||e.measure_speed_js(),t=!0})}},{key:"addXMLRequestCallback",value:function(e){var t,r;XMLHttpRequest.callbacks?XMLHttpRequest.callbacks.push(e):(XMLHttpRequest.callbacks=[e],t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){for(r=0;r<XMLHttpRequest.callbacks.length;r++)XMLHttpRequest.callbacks[r](this);t.apply(this,arguments)})}},{key:"ajax_x",value:function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(var e,t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"],r=0;r<t.length;r++)try{e=new ActiveXObject(t[r]);break}catch(e){}return e}},{key:"ajax_send",value:function(e,t,r,n,a){void 0===a&&(a=!0);var o=this.ajax_x();o.open(r,e,a),o.onreadystatechange=function(){4===o.readyState&&t(o.responseText)},"POST"===r&&o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(n)}},{key:"ajax_get",value:function(e,t,r,n){var a=[];for(var o in t)a.push(encodeURIComponent(o)+"="+encodeURIComponent(t[o]));this.ajax_send(e+(a.length?"?"+a.join("&"):""),r,"GET",null,n)}},{key:"end",value:function(){this.endTime=new Date;var e=this.endTime-this.startTime;return e/=1e3,Math.round(e)}}]),e}();!function(){try{window.artHandler=new ArtHandler}catch(e){console.log("Something wrong with debuger",e)}}();